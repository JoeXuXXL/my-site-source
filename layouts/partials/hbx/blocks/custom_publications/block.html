{{/*
  layouts/partials/hbx/blocks/custom_publications/block.html
  REVISED - A self-contained block for a compact, centered, and icon-rich publication list.
*/}}

{{ $block := . }}

{{/* Use a standard container to center the content on the page */}}
<div class="container mx-auto px-4">
  {{ with $block.Content.title }}
  <div class="relative mb-12 text-center">
    <h1 class="text-4xl font-bold tracking-tight">{{ . }}</h1>
    <div class="absolute left-1/2 -translate-x-1/2 -bottom-3 h-1 w-24 bg-primary-500"></div>
  </div>
  {{ end }}
  
  {{ $pages := where site.RegularPages "Type" "publication" }}
  {{ $sorted_pages := $pages.ByDate.Reverse }}
  {{ $groups := $sorted_pages.GroupByDate "2006" }}

  {{/* 3. GLOBAL REVERSE-CHRONOLOGICAL NUMBERING */}}
  {{/* Initialize a counter with the total number of papers */}}
  {{ $total_papers := len $sorted_pages }}
  {{ $counter := $total_papers }}

  <!-- Main container for all years -->
  <div class="space-y-10">
    {{ range $groups }}
      <!-- 2. YEAR STYLE: Less prominent and more compact heading */}}
      <div class="relative">
        <h2 class="text-2xl font-semibold text-gray-500 dark:text-gray-400">{{ .Key }}</h2>
        <div class="absolute -bottom-1 h-px w-16 bg-gray-300 dark:bg-gray-700"></div>
      </div>

      <!-- Container for papers within a single year (tighter spacing) -->
      <div class="mt-6 space-y-6">
        {{ range $page := .Pages }}
          {{ $params := $page.Params }}

          <div class="flex items-start space-x-4">
            <!-- Global publication number -->
            <div class="flex-shrink-0 text-base font-medium text-gray-500 dark:text-gray-400 w-12 text-right pt-1">
              [P{{ $counter }}]
            </div>
            
            <div class="flex-grow">
              <!-- Title -->
              <h3 class="text-xl font-semibold leading-snug">
                {{/* Note: Title is no longer a link, as per the reference example. The whole entry leads to the page. */}}
                {{ $page.Title }}
              </h3>

              <!-- Authors (with your name bolded) -->
              <div class="mt-1 text-base text-gray-600 dark:text-gray-400">
                {{ $authors := delimit $params.authors ", " }}
                {{ $authors_processed := replace $authors "Xiangling Xu" "**Xiangling Xu**" | markdownify }}
                {{ $authors_processed | safeHTML }}
              </div>

              <!-- Publication Venue -->
              {{ with $params.publication }}
              <div class="mt-1 text-base italic text-gray-500 dark:text-gray-500">
                {{ . | markdownify }}
              </div>
              {{ end }}
              
              <!-- 4. ACTION LINKS WITH ICONS -->
              <div class="mt-3 flex flex-wrap items-center gap-x-5 gap-y-2 text-sm font-medium">
                {{/* Link to the publication's own page */}}
                <a href="{{ $page.RelPermalink }}" class="text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-500">
                  <i class="fas fa-book-open mr-1"></i>Details
                </a>
                {{ with $page.GetPage "cite.bib" }}<a href="{{ .RelPermalink }}" target="_blank" class="hover:text-primary-600 dark:hover:text-primary-400"><i class="far fa-file-alt mr-1"></i>Cite</a>{{ end }}
                {{ with $params.hugoblox.ids.doi }}<a href="{{ . }}" target="_blank" rel="noopener" class="hover:text-primary-600 dark:hover:text-primary-400"><i class="ai ai-doi mr-1"></i>DOI</a>{{ end }}
                {{ range $params.links }}
                  {{ if eq .name "arXiv" }}<a href="{{ .url }}" target="_blank" rel="noopener" class="hover:text-primary-600 dark:hover:text-primary-400"><i class="ai ai-arxiv mr-1"></i>arXiv</a>{{ end }}
                  {{ if eq .name "PDF" }}<a href="{{ .url }}" target="_blank" rel="noopener" class="hover:text-primary-600 dark:hover:text-primary-400"><i class="far fa-file-pdf mr-1"></i>PDF</a>{{ end }}
                  {{ if eq .name "URL" }}<a href="{{ .url }}" target="_blank" rel="noopener" class="hover:text-primary-600 dark:hover:text-primary-400"><i class="fas fa-link mr-1"></i>URL</a>{{ end }}
                {{ end }}
              </div>
            </div>
          </div>
          {{/* Decrement the global counter after each paper */}}
          {{ $counter = sub $counter 1 }}
        {{ end }}
      </div>
    {{ end }}
  </div>
</div>